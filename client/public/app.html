<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>24/7 Tele H - Health Monitor</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Arial, sans-serif; background: #f9fafb; min-height: 100vh; }
    .container { display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 1rem; }
    .card { background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); width: 100%; max-width: 400px; }
    .header { text-align: center; margin-bottom: 2rem; }
    .title { font-size: 1.5rem; font-weight: bold; color: #111827; margin-bottom: 0.5rem; }
    .subtitle { font-size: 0.875rem; color: #6b7280; }
    .form { display: flex; flex-direction: column; gap: 1rem; }
    .input { padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.875rem; }
    .button { padding: 0.75rem; background: #2563eb; color: white; border: none; border-radius: 6px; font-size: 0.875rem; cursor: pointer; }
    .button:hover { background: #1d4ed8; }
    .button:disabled { background: #9ca3af; cursor: not-allowed; }
    .error { padding: 0.75rem; background: #fef2f2; border: 1px solid #fecaca; border-radius: 6px; color: #dc2626; font-size: 0.875rem; margin-bottom: 1rem; display: none; }
    .demo { text-align: center; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid #e5e7eb; }
    .demo-title { font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem; }
    .demo-text { font-size: 0.75rem; color: #9ca3af; margin: 0.25rem 0; }
    .dashboard { background: #f9fafb; min-height: 100vh; padding: 1.5rem; }
    .dashboard-container { max-width: 1200px; margin: 0 auto; }
    .dashboard-header { background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 1.5rem; display: flex; justify-content: space-between; align-items: center; }
    .dashboard-content { background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .status-box { background: #f3f4f6; padding: 1rem; border-radius: 6px; border: 1px solid #e5e7eb; margin-top: 1.5rem; }
    .status-list { margin: 0; padding-left: 1.25rem; }
    .status-item { color: #059669; margin-bottom: 0.25rem; }
    .logout-btn { padding: 0.5rem 1rem; background: #ef4444; color: white; border: none; border-radius: 6px; font-size: 0.875rem; cursor: pointer; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div id="loginView" class="container">
    <div class="card">
      <div class="header">
        <h1 class="title">24/7 Tele H</h1>
        <p class="subtitle">Health Monitoring System</p>
      </div>
      
      <div id="error" class="error"></div>
      
      <form id="loginForm" class="form">
        <input id="email" type="email" class="input" placeholder="Email Address" required>
        <input id="password" type="password" class="input" placeholder="Password" required>
        <button id="loginBtn" type="submit" class="button">Sign In</button>
      </form>
      
      <div class="demo">
        <p class="demo-title">Demo Accounts:</p>
        <p class="demo-text">Admin: admin@24x7teleh.com / admin123</p>
        <p class="demo-text">Patient: patient.demo@example.com / patient123</p>
      </div>
    </div>
  </div>

  <div id="adminView" class="dashboard hidden">
    <div class="dashboard-container">
      <div class="dashboard-header">
        <div>
          <h1 style="font-size: 1.75rem; font-weight: bold; color: #111827; margin-bottom: 0.5rem;">Admin Dashboard</h1>
          <p style="font-size: 1rem; color: #6b7280;">Manage patient dashboard access for 24/7 Tele H</p>
        </div>
        <button id="adminLogout" class="logout-btn">Logout</button>
      </div>
      
      <div class="dashboard-content">
        <h2 id="adminWelcome" style="font-size: 1.25rem; font-weight: 600; color: #111827; margin-bottom: 1rem;"></h2>
        <p style="color: #6b7280; margin-bottom: 1.5rem;">You have successfully logged in as an administrator. SendGrid has been removed and the system is working with test mode OTP.</p>
        
        <div class="status-box">
          <h3 style="font-size: 1rem; font-weight: 500; color: #111827; margin-bottom: 0.75rem;">System Status</h3>
          <ul class="status-list">
            <li class="status-item">✓ SendGrid email service removed</li>
            <li class="status-item">✓ Test mode OTP system active</li>
            <li class="status-item">✓ Admin authentication working</li>
            <li class="status-item">✓ Database connection established</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div id="patientView" class="dashboard hidden">
    <div style="max-width: 800px; margin: 0 auto;">
      <div class="dashboard-content" style="text-align: center;">
        <h1 id="patientWelcome" style="font-size: 1.5rem; font-weight: bold; color: #111827; margin-bottom: 1rem;"></h1>
        <p style="color: #6b7280; margin-bottom: 1.5rem;">You have successfully logged in to the 24/7 Tele H health monitoring system.</p>
        <button id="patientLogout" class="logout-btn" style="padding: 0.75rem 1.5rem;">Logout</button>
      </div>
    </div>
  </div>

  <script>
    let currentUser = null;

    document.getElementById('loginForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const errorDiv = document.getElementById('error');
      const loginBtn = document.getElementById('loginBtn');
      
      loginBtn.disabled = true;
      loginBtn.textContent = 'Signing in...';
      errorDiv.style.display = 'none';
      
      try {
        const response = await fetch('/api/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });
        
        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.message || 'Login failed');
        }
        
        const result = await response.json();
        currentUser = result.user;
        
        if (result.user.role === 'admin') {
          showAdminDashboard();
        } else {
          showPatientDashboard();
        }
      } catch (err) {
        errorDiv.textContent = err.message || 'Login failed. Please try again.';
        errorDiv.style.display = 'block';
      } finally {
        loginBtn.disabled = false;
        loginBtn.textContent = 'Sign In';
      }
    });

    function showAdminDashboard() {
      document.getElementById('loginView').classList.add('hidden');
      document.getElementById('patientView').classList.add('hidden');
      document.getElementById('adminView').classList.remove('hidden');
      document.getElementById('adminWelcome').textContent = `Welcome, ${currentUser.firstName} ${currentUser.lastName}`;
    }

    function showPatientDashboard() {
      document.getElementById('loginView').classList.add('hidden');
      document.getElementById('adminView').classList.add('hidden');
      document.getElementById('patientView').classList.remove('hidden');
      document.getElementById('patientWelcome').textContent = `Welcome, ${currentUser.firstName} ${currentUser.lastName}`;
    }

    function logout() {
      currentUser = null;
      document.getElementById('adminView').classList.add('hidden');
      document.getElementById('patientView').classList.add('hidden');
      document.getElementById('loginView').classList.remove('hidden');
      document.getElementById('email').value = '';
      document.getElementById('password').value = '';
      document.getElementById('error').style.display = 'none';
    }

    document.getElementById('adminLogout').addEventListener('click', logout);
    document.getElementById('patientLogout').addEventListener('click', logout);
  </script>
</body>
</html>