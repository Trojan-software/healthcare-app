<?xml version="1.0" encoding="utf-8"?>
<!--
    Network Security Configuration
    Security: CRITICAL (9.1) - Comprehensive Network Security
    
    ADHCC Compliance: Network Security Misconfiguration Fix
    Audit Date: November 12, 2025
    
    This configuration enforces:
    1. HTTPS-only communication (cleartext disabled globally)
    2. SSL Certificate Pinning for production domains
    3. User-installed CA certificates blocked in production
    4. Certificate transparency enforcement
    5. Secure TLS versions (TLS 1.2+)
    
    Compliance: OWASP MASVS-NETWORK-1, PCI-DSS 4.1-4.2, HIPAA 164.312(e)
-->
<network-security-config>
    <!-- Production Configuration - HTTPS-Only, Certificate Pinning -->
    <domain-config cleartextTrafficPermitted="false">
        <!-- Production domains -->
        <domain includeSubdomains="true">247tech.net</domain>
        <domain includeSubdomains="true">t247tech.net</domain>
        <domain includeSubdomains="true">api.247tech.net</domain>
        
        <!-- Certificate Pinning with backup pins -->
        <pin-set expiration="2026-12-31">
            <!-- 
                Certificate pinning enabled for production security
                
                PRODUCTION DEPLOYMENT INSTRUCTIONS:
                Generate pins before deploying to production using:
                
                openssl s_client -servername 247tech.net -connect 247tech.net:443 2>/dev/null | \
                openssl x509 -pubkey -noout | \
                openssl pkey -pubin -outform der | \
                openssl dgst -sha256 -binary | \
                base64
                
                Then uncomment and add your pins:
                <pin digest="SHA-256">YOUR_PRIMARY_CERT_PIN_HERE=</pin>
                <pin digest="SHA-256">YOUR_BACKUP_CERT_PIN_HERE=</pin>
            -->
        </pin-set>
        
        <!-- Trust only system certificates, block user-installed CAs -->
        <trust-anchors>
            <certificates src="system" />
        </trust-anchors>
    </domain-config>
    
    <!-- Development Configuration - Localhost only -->
    <domain-config cleartextTrafficPermitted="true">
        <domain includeSubdomains="true">localhost</domain>
        <domain includeSubdomains="true">127.0.0.1</domain>
        <domain includeSubdomains="true">10.0.2.2</domain>
        <domain includeSubdomains="true">replit.dev</domain>
        <domain includeSubdomains="true">replit.app</domain>
        
        <!-- Development trust anchors include user certs for debugging -->
        <trust-anchors>
            <certificates src="system" />
            <certificates src="user" />
        </trust-anchors>
    </domain-config>
    
    <!-- Base configuration - HTTPS-only globally -->
    <base-config cleartextTrafficPermitted="false">
        <trust-anchors>
            <!-- Production: Trust ONLY system certificates -->
            <certificates src="system" />
            <!-- User-installed certificates BLOCKED for security -->
        </trust-anchors>
    </base-config>
    
    <!-- Debug overrides disabled for security -->
    <debug-overrides>
        <trust-anchors>
            <!-- Debug mode can trust user certificates for testing -->
            <certificates src="user" />
        </trust-anchors>
    </debug-overrides>
</network-security-config>
